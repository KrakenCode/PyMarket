{% extends "base.html" %}

  {% block content %}
<style>
  td.details-control {
    background: url('https://datatables.net/examples/resources/details_open.png') no-repeat center center;
    cursor: pointer;
  }
  tr.shown td.details-control {
      background: url('https://datatables.net/examples/resources/details_close.png') no-repeat center center;
  }
</style>
<div class="container-fluid">
  <h1 align="center">This is the inventory page</h1>
  <div align="right" >
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addModal" data-whatever="@Add">
      Add
    </button>
    <a href="{{ url_for('user_auth.logout') }}">Logout</a>

  </div>
  <!--Add Button Model-->
  <div class="modal fade" id='addModal' tabindex="1" role="dialog" aria-labelledby="addModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addModal">Add new product</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form action="/inventoryadder" method="post">
            <div class="form-row align-items-center">
              <div class="col-auto">
                <label for="validationSKU">SKU</label>
                <input type="text" name="SKU" class="form-control mb-2" id="validationSKU" placeholder="SKU" required pattern="[0-9]{3}" maxlength="3">
              </div>
              <div class="col-auto">
                <label for="validationName">Product Name</label>
                <input type="text" name="Name" class="form-control mb-2" id="validationName" placeholder="Apple" required pattern="[A-Za-z]+" maxlength="14">
              </div>
              <div class="col-auto">
                <label for="validationRP">Reorder Point</label>
                <input type="text" name="RP" class="form-control mb-2" id="validationRP" placeholder="200" required min="1" max="8" pattern="[0-9]*">
              </div>
              <div class="col-auto">
                <label for="validationQ">Quantity</label>
                <input type="text" name="Amount" class="form-control mb-2" id="validationQ" placeholder="500" required min="1" max="8" pattern="[0-9]*">
              </div>
              <div class="col-auto">
                <label for="validationPrice">Price</label>
                <input type="text" name="Price" class="form-control mb-2" id="validationPrice" placeholder="5.00" required min="1" max="8" pattern="[0-9]*.{1}[0-9]*">
              </div>
              <div class="col-auto">
                <label for="validationCat">Category</label>
                <input type="text" name="Cat" class="form-control mb-2" id="validationCat" placeholder="Fruit" required pattern="[A-Za-z]+" maxlength="14">
              </div>
              <div class="col-auto">
                <label for="validationStock">Stock</label>
                <input type="text" name="Stock" class="form-control mb-2" id="validationStock" placeholder="500" required min="1" max="8" pattern="[0-9]*">
              </div>
                <input type="submit" class="btn btn-primary"></input>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
  <!--End of Add Button Model-->

  <div class="container">
    <div class="table-responsive">
        <table id="inventory_table" style="width:100%" class="table table-striped table-bordered"></table>
    </div>
  </div>
</div>
<script>
  function format ( d ) {
    // `d` is the original data object for the row
    return '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">'+
        '<tr>'+
            '<td>Full name:</td>'+
            '<td>'+'Name'+'</td>'+
        '</tr>'+
        '<tr>'+
            '<td>Extension number:</td>'+
            '<td>'+"something"+'</td>'+
        '</tr>'+
        '<tr>'+
            '<td>Extra info:</td>'+
            '<td>And any further details here (images etc)...</td>'+
        '</tr>'+
    '</table>';
  }

  $(document).ready(function() {
    var inventory_data = {{inventory|tojson}};
    console.log(typeof(inventory_data))
    var table = $('#inventory_table').DataTable( {
      data: inventory_data,
      columns: [
        { title: "SKU" },
        { title: "Name" },
        { title: "Reorder Point" },
        { title: "Quantity" },
        { title: "Options" }
      ],
      "columnDefs": [ {
          "targets": -1,
          "className":      'details-control',
          "orderable":      false,
          "data":           null,
          "defaultContent": ''
      } ]

    } );

    // Add event listener for opening and closing details
    $('#inventory_table tbody').on('click', 'td.details-control', function () {
        var tr = $(this).closest('tr');
        var row = table.row( tr );

        if ( row.child.isShown() ) {
            // This row is already open - close it
            row.child.hide();
            tr.removeClass('shown');
        }
        else {
            // Open this row
            row.child( format(row.data()) ).show();
            tr.addClass('shown');
        }
    } );

  } );
</script>
{% endblock %}
